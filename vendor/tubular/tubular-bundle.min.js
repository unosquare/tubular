"use strict";!function(e){e.module("tubular",["tubular.directives","tubular.services","tubular.models"]).info({version:"1.5.1"})}(angular),function(e){e.module("tubular.directives",["tubular.models","tubular.services"]).directive("tbGridTable",[function(){return{require:"^tbGrid",templateUrl:"tbGridTable.tpl.html",restrict:"E",replace:!0,transclude:!0,scope:!0,controller:["$scope",function(e){e.$component=e.$parent.$parent.$ctrl,e.tubularDirective="tubular-grid-table"}]}}]).directive("tbColumnDefinitions",[function(){return{require:"^tbGridTable",templateUrl:"tbColumnDefinitions.tpl.html",restrict:"E",replace:!0,transclude:!0,scope:!0,controller:["$scope",function(e){e.$component=e.$parent.$parent.$component,e.tubularDirective="tubular-column-definitions"}],compile:function(){return{post:function(e){return e.$component.hasColumnsDefinitions=!0}}}}}]).directive("tbColumn",[function(){return{require:"^tbColumnDefinitions",template:'<th ng-transclude ng-class="{sortable: column.Sortable}" ng-show="column.Visible"></th>',restrict:"E",replace:!0,transclude:!0,scope:{visible:"=",label:"@",name:"@",sortable:"=?",sortOrder:"=?",isKey:"=?",searchable:"=?",columnType:"@?",aggregate:"@?",sortDirection:"@?"},controller:["$scope",function(t){t.column={Label:""},t.$component=t.$parent.$parent.$component,t.tubularDirective="tubular-column",t.label=t.label||(t.name||"").replace(/([a-z])([A-Z])/g,"$1 $2"),t.sortColumn=function(e){return t.$component.sortColumn(t.column.Name,e)},t.$watch("visible",function(n){e.isDefined(n)&&(t.column.Visible=n)}),t.$watch("label",function(){t.column.Label=t.label,t.$broadcast("tbColumn_LabelChanged",t.label)});var n=new function(){this.Name=t.name||null,this.Label=t.label||null,this.Sortable=t.sortable,this.SortOrder=parseInt(t.sortOrder)||-1,this.SortDirection=function(){return e.isUndefined(t.sortDirection)?"None":0===t.sortDirection.toLowerCase().indexOf("asc")?"Ascending":0===t.sortDirection.toLowerCase().indexOf("desc")?"Descending":"None"}(),this.IsKey=!!e.isDefined(t.isKey)&&t.isKey,this.Searchable=!!e.isDefined(t.searchable)&&t.searchable,this.Visible="false"!==t.visible,this.Filter=null,this.DataType=t.columnType||"string",this.Aggregate=t.aggregate||"none"};t.$component.addColumn(n),t.column=n,t.label=n.Label}]}}]).directive("tbColumnHeader",[function(){return{require:"^tbColumn",templateUrl:"tbColumnHeader.tpl.html",restrict:"E",replace:!0,transclude:!0,scope:!1,controller:["$scope",function(e){e.sortColumn=function(t){return e.$parent.sortColumn(t.ctrlKey)},e.$on("tbColumn_LabelChanged",function(t,n){return e.label=n})}],link:function(e,t){t.find("ng-transclude").length>0&&t.find("span")[0].remove(),e.$parent.column.Sortable||t.find("a").replaceWith(t.find("a").children())}}}]).directive("tbRowSet",[function(){return{require:"^tbGrid",templateUrl:"tbRowSet.tpl.html",restrict:"E",replace:!0,transclude:!0,scope:!1,controller:["$scope",function(e){e.$component=e.$parent.$component||e.$parent.$parent.$component,e.tubularDirective="tubular-row-set"}]}}]).directive("tbFootSet",[function(){return{require:"^tbGrid",templateUrl:"tbFootSet.tpl.html",restrict:"E",replace:!0,transclude:!0,scope:!1,controller:["$scope",function(e){e.$component=e.$parent.$component||e.$parent.$parent.$component,e.tubularDirective="tubular-foot-set"}]}}]).directive("tbRowTemplate",["$timeout",function(t){return{templateUrl:"tbRowTemplate.tpl.html",restrict:"E",replace:!0,transclude:!0,scope:{model:"=rowModel"},controller:["$scope",function(t){t.tubularDirective="tubular-rowset",t.fields=[],t.hasFieldsDefinitions=!1,t.$component=t.$parent.$parent.$parent.$component,t.$watch("hasFieldsDefinitions",function(n){!0!==n||e.isUndefined(t.model)||t.bindFields()}),t.bindFields=function(){return e.forEach(t.fields,function(e){return e.bindScope()})}}],compile:function(){return{post:function(e){return t(function(){return e.hasFieldsDefinitions=!0},300)}}}}}]).directive("tbCellTemplate",[function(){return{require:"^tbRowTemplate",templateUrl:"tbCellTemplate.tpl.html",restrict:"E",replace:!0,transclude:!0,scope:{columnName:"@?"},controller:["$scope",function(e){if(e.column={Visible:!0},e.columnName=e.columnName||null,e.$component=e.$parent.$parent.$component,e.getFormScope=function(){return null},null!=e.columnName){var t=e.$component.columns.filter(function(t){return t.Name===e.columnName});t.length>0&&(e.column=t[0])}}]}}])}(angular),function(e){e.module("tubular.directives").run(["$templateCache",function(e){e.put("tbCheckboxField.tpl.html",'<div ng-class="{ \'checkbox\' : $ctrl.isEditing, \'has-error\' : !$ctrl.$valid && $ctrl.$dirty() }" class=tubular-checkbox><input type=checkbox ng-model=$ctrl.value ng-disabled="$ctrl.readOnly || !$ctrl.isEditing" class=tubular-checkbox id={{$ctrl.name}} name={{$ctrl.name}}><label ng-show=$ctrl.isEditing for={{$ctrl.name}} ng-bind=$ctrl.label></label><span class="help-block error-block" ng-show=$ctrl.isEditing ng-repeat="error in $ctrl.state.$errors">{{error}}</span> <span class=help-block ng-show="$ctrl.isEditing && $ctrl.help" ng-bind=$ctrl.help></span></div>'),e.put("tbDropdownEditor.tpl.html",'<div ng-class="{ \'form-group\' : $ctrl.showLabel && $ctrl.isEditing, \'has-error\' : !$ctrl.$valid && $ctrl.$dirty() }"><span ng-hide=$ctrl.isEditing ng-bind=$ctrl.readOnlyValue></span><label ng-show=$ctrl.showLabel ng-bind=$ctrl.label></label><select ng-options="{{ $ctrl.selectOptions }}" ng-show=$ctrl.isEditing ng-model=$ctrl.value class=form-control ng-required=$ctrl.required ng-disabled=$ctrl.readOnly name={{$ctrl.name}} ng-change="onChange({value: value})"></select><span class="help-block error-block" ng-show=$ctrl.isEditing ng-repeat="error in $ctrl.state.$errors">{{error}}</span> <span class=help-block ng-show="$ctrl.isEditing && $ctrl.help" ng-bind=$ctrl.help></span></div>'),e.put("tbNumericEditor.tpl.html","<div ng-class=\"{ 'form-group' : $ctrl.showLabel && $ctrl.isEditing, 'has-error' : !$ctrl.$valid && $ctrl.$dirty() }\"><span ng-hide=$ctrl.isEditing>{{$ctrl.value | numberorcurrency: format }}</span><label ng-show=$ctrl.showLabel ng-bind=$ctrl.label></label><div class=input-group ng-show=$ctrl.isEditing><div class=input-group-addon ng-hide=\"$ctrl.format == 'I'\"><i ng-class=\"{ 'fa': true, 'fa-calculator': $ctrl.format != 'C', 'fa-usd': $ctrl.format == 'C'}\"></i></div><input type=number placeholder={{$ctrl.placeholder}} ng-model=$ctrl.value class=form-control ng-required=$ctrl.required ng-hide=$ctrl.readOnly step=\"{{$ctrl.step || 'any'}}\" name={{$ctrl.name}}><p class=\"form-control form-control-static text-right\" ng-show=$ctrl.readOnly>{{$ctrl.value | numberorcurrency: format}}</p></div><span class=\"help-block error-block\" ng-show=$ctrl.isEditing ng-repeat=\"error in $ctrl.state.$errors\">{{error}}</span> <span class=help-block ng-show=\"$ctrl.isEditing && $ctrl.help\" ng-bind=$ctrl.help></span></div>"),e.put("tbSimpleEditor.tpl.html",'<div ng-class="{ \'form-group\' : $ctrl.showLabel && $ctrl.isEditing, \'has-error\' : !$ctrl.$valid && $ctrl.$dirty() }"><span ng-hide=$ctrl.isEditing ng-bind=$ctrl.value></span><label ng-show=$ctrl.showLabel ng-bind=$ctrl.label></label><input type={{$ctrl.editorType}} placeholder={{$ctrl.placeholder}} ng-show=$ctrl.isEditing ng-model=$ctrl.value class=form-control ng-required=$ctrl.required ng-readonly=$ctrl.readOnly name={{$ctrl.name}}> <span class="help-block error-block" ng-show=$ctrl.isEditing ng-repeat="error in $ctrl.state.$errors">{{error}}</span> <span class=help-block ng-show="$ctrl.isEditing && $ctrl.help" ng-bind=$ctrl.help></span></div>'),e.put("tbTextArea.tpl.html",'<div ng-class="{ \'form-group\' : $ctrl.showLabel && $ctrl.isEditing, \'has-error\' : !$ctrl.$valid && $ctrl.$dirty() }"><span ng-hide=$ctrl.isEditing ng-bind=$ctrl.value></span><label ng-show=$ctrl.showLabel ng-bind=$ctrl.label></label><textarea ng-show=$ctrl.isEditing placeholder={{$ctrl.placeholder}} ng-model=$ctrl.value class=form-control ng-required=$ctrl.required ng-readonly=$ctrl.readOnly name={{$ctrl.name}}></textarea><span class="help-block error-block" ng-show=$ctrl.isEditing ng-repeat="error in $ctrl.state.$errors">{{error}}</span> <span class=help-block ng-show="$ctrl.isEditing && $ctrl.help" ng-bind=$ctrl.help></span></div>'),e.put("tbForm.tpl.html","<form ng-transclude name={{name}}></form>"),e.put("tbEditButton.tpl.html","<button ng-click=$ctrl.edit() class=\"btn btn-xs btn-default\" ng-hide=$ctrl.model.$isEditing>{{:: $ctrl.caption || ('CAPTION_EDIT' | translate) }}</button>"),e.put("tbExportButton.tpl.html","<div class=btn-group uib-dropdown><button class=\"btn btn-info btn-sm {{::$ctrl.css}}\" uib-dropdown-toggle><span class=\"fa fa-download\"></span>&nbsp;{{:: $ctrl.caption || ('UI_EXPORTCSV' | translate)}}&nbsp;<span class=caret></span></button><ul class=dropdown-menu uib-dropdown-menu><li><a href=javascript:void(0) ng-click=$ctrl.downloadCsv($parent)>{{:: $ctrl.captionMenuCurrent || ('UI_CURRENTROWS' | translate)}}</a></li><li><a href=javascript:void(0) ng-click=$ctrl.downloadAllCsv($parent)>{{:: $ctrl.captionMenuAll || ('UI_ALLROWS' | translate)}}</a></li></ul></div>"),e.put("tbGridPager.tpl.html","<div class=tubular-pager><ul uib-pagination ng-disabled=$ctrl.$component.isEmpty direction-links=true first-text=&#xf049; previous-text=&#xf04a; next-text=&#xf04e; last-text=&#xf050; boundary-links=true total-items=$ctrl.$component.filteredRecordCount items-per-page=$ctrl.$component.pageSize max-size=5 ng-model=$ctrl.$component.currentPage ng-change=$ctrl.pagerPageChanged()></ul></div>"),e.put("tbGridPagerInfo.tpl.html","<div class=\"pager-info small\" ng-hide=$ctrl.$component.isEmpty>{{'UI_SHOWINGRECORDS' | translate: $ctrl.currentInitial:$ctrl.currentTop:$ctrl.$component.filteredRecordCount}} <span ng-show=$ctrl.filtered>{{'UI_FILTEREDRECORDS' | translate: $ctrl.$component.totalRecordCount}}</span></div>"),e.put("tbPageSizeSelector.tpl.html",'<div class={{::$ctrl.css}}><form class=form-inline><div class=form-group><label class=small>{{:: $ctrl.caption || (\'UI_PAGESIZE\' | translate) }}</label>&nbsp;<select ng-model=$ctrl.$component.pageSize class="form-control input-sm {{::$ctrl.selectorCss}}" ng-options="item for item in options"></select></div></form></div>'),e.put("tbPrintButton.tpl.html",'<button class="btn btn-default btn-sm" ng-click=$ctrl.printGrid()><span class="fa fa-print"></span>&nbsp;{{:: $ctrl.caption || (\'CAPTION_PRINT\' | translate)}}</button>'),e.put("tbRemoveButton.tpl.html","<button class=\"btn btn-danger btn-xs btn-popover\" uib-popover-template=$ctrl.templateName popover-placement=right popover-title=\"{{ $ctrl.legend || ('UI_REMOVEROW' | translate) }}\" popover-is-open=$ctrl.isOpen popover-trigger=\"'click outsideClick'\" ng-hide=$ctrl.model.$isEditing><span ng-show=$ctrl.showIcon class={{::$ctrl.icon}}></span> <span ng-show=$ctrl.showCaption>{{:: $ctrl.caption || ('CAPTION_REMOVE' | translate) }}</span></button>"),e.put("tbRemoveButtonPopover.tpl.html",'<div class=tubular-remove-popover><button ng-click=$ctrl.delete() class="btn btn-danger btn-xs">{{:: $ctrl.caption || (\'CAPTION_REMOVE\' | translate) }}</button> &nbsp; <button ng-click="$ctrl.isOpen = false;" class="btn btn-default btn-xs">{{:: $ctrl.cancelCaption || (\'CAPTION_CANCEL\' | translate) }}</button></div>'),e.put("tbSaveButton.tpl.html","<div ng-show=model.$isEditing><button ng-click=save() class=\"btn btn-default {{:: saveCss || '' }}\" ng-disabled=!model.$valid()>{{:: saveCaption || ('CAPTION_SAVE' | translate) }}</button> <button ng-click=cancel() class=\"btn {{:: cancelCss || 'btn-default' }}\">{{:: cancelCaption || ('CAPTION_CANCEL' | translate) }}</button></div>"),e.put("tbTextSearch.tpl.html",'<div class=tubular-grid-search><div class="input-group input-group-sm"><span class=input-group-addon><i class="fa fa-search"></i> </span><input type=search name=tbTextSearchInput class=form-control placeholder="{{:: $ctrl.placeholder || (\'UI_SEARCH\' | translate) }}" maxlength=20 ng-model=$ctrl.$component.search.Text ng-model-options="{ debounce: 300 }"> <span id=tb-text-search-reset-panel class=input-group-btn ng-show="$ctrl.$component.search.Text.length > 0"><button id=tb-text-search-reset-button class="btn btn-default" uib-tooltip="{{\'CAPTION_CLEAR\' | translate}}" ng-click="$ctrl.$component.search.Text = \'\'"><i class="fa fa-times-circle"></i></button></span></div></div>'),e.put("tbColumnDateTimeFilter.tpl.html",'<div class=tubular-column-menu><button class="btn btn-xs btn-default btn-popover" uib-popover-template=$ctrl.templateName popover-placement=bottom popover-title={{$ctrl.filterTitle}} popover-is-open=$ctrl.isOpen popover-trigger="\'outsideClick\'" ng-class="{ \'btn-success\': $ctrl.filter.HasFilter }"><i class="fa fa-filter"></i></button></div>'),e.put("tbColumnFilter.tpl.html",'<div class=tubular-column-menu><button class="btn btn-xs btn-default btn-popover" uib-popover-template=$ctrl.templateName popover-placement=bottom popover-title={{$ctrl.filterTitle}} popover-is-open=$ctrl.isOpen popover-trigger="\'click outsideClick\'" ng-class="{ \'btn-success\': $ctrl.filter.HasFilter }"><i class="fa fa-filter"></i></button></div>'),e.put("tbColumnFilterPopover.tpl.html",'<div><form class=tubular-column-filter-form onsubmit="return false;"><select class=form-control ng-options="key as value for (key , value) in $ctrl.filterOperators" ng-model=$ctrl.filter.Operator ng-hide="$ctrl.dataType == \'boolean\' || $ctrl.onlyContains"></select>&nbsp; <input class=form-control type=search ng-model=$ctrl.filter.Text autofocus ng-keypress=$ctrl.checkEvent($event) ng-hide="$ctrl.dataType == \'boolean\'" placeholder="{{\'CAPTION_VALUE\' | translate}}" ng-disabled="$ctrl.filter.Operator == \'None\'"><div class=text-center ng-show="$ctrl.dataType == \'boolean\'"><button type=button class="btn btn-default btn-md" ng-disabled="$ctrl.filter.Text === true" ng-click="$ctrl.filter.Text = true; $ctrl.filter.Operator = \'Equals\';"><i class="fa fa-check"></i></button>&nbsp; <button type=button class="btn btn-default btn-md" ng-disabled="$ctrl.filter.Text === false" ng-click="$ctrl.filter.Text = false; $ctrl.filter.Operator = \'Equals\';"><i class="fa fa-times"></i></button></div><input type=search class=form-control ng-model=$ctrl.filter.Argument[0] ng-keypress=$ctrl.checkEvent($event) ng-show="$ctrl.filter.Operator == \'Between\'"><hr><tb-column-filter-buttons></tb-column-filter-buttons></form></div>'),e.put("tbColumnOptionsFilter.tpl.html",'<div><form class=tubular-column-filter-form onsubmit="return false;"><select class="form-control checkbox-list" ng-options="item.Key as item.Label for item in $ctrl.optionsItems" ng-model=$ctrl.filter.Argument multiple ng-disabled="$ctrl.dataIsLoaded == false"></select>&nbsp;<hr><tb-column-filter-buttons></tb-column-filter-buttons></form></div>'),e.put("tbColumnSelector.tpl.html",'<button class="btn btn-sm btn-default" ng-click=$ctrl.openColumnsSelector() ng-bind="\'CAPTION_SELECTCOLUMNS\' | translate"></button>'),e.put("tbColumnSelectorDialog.tpl.html",'<div class=modal-header><h3 class=modal-title ng-bind="\'CAPTION_SELECTCOLUMNS\' | translate"></h3></div><div class=modal-body><table class="table table-bordered table-responsive table-striped table-hover table-condensed"><thead><tr><th>Visible?</th><th>Name</th></tr></thead><tbody><tr ng-repeat="col in Model"><td><input type=checkbox ng-model=col.Visible ng-disabled="col.Visible && isInvalid()"></td><td ng-bind=col.Label></td></tr></tbody></table></div><div class=modal-footer><button class="btn btn-warning" ng-click=closePopup() ng-bind="\'CAPTION_CLOSE\' | translate"></button></div>'),e.put("tbCellTemplate.tpl.html","<td ng-transclude ng-show=column.Visible data-label={{::column.Label}} style=height:auto></td>"),e.put("tbColumnDefinitions.tpl.html","<thead><tr ng-transclude></tr></thead>"),e.put("tbColumnFilterButtons.tpl.html",'<div class=text-right><button class="btn btn-sm btn-success" ng-click=$ctrl.currentFilter.applyFilter() ng-disabled="$ctrl.currentFilter.filter.Operator == \'None\'" ng-bind="\'CAPTION_APPLY\' | translate"></button>&nbsp; <button class="btn btn-sm btn-danger" ng-click=$ctrl.currentFilter.clearFilter() ng-bind="\'CAPTION_CLEAR\' | translate"></button></div>'),e.put("tbColumnHeader.tpl.html","<span><a title=\"Click to sort. Press Ctrl to sort by multiple columns\" class=column-header href ng-click=sortColumn($event)><span class=column-header-default>{{ $parent.column.Label }}</span><ng-transclude></ng-transclude></a><i class=\"fa sort-icon\" ng-class=\"{'fa-long-arrow-up': $parent.column.SortDirection == 'Ascending', 'fa-long-arrow-down': $parent.column.SortDirection == 'Descending'}\">&nbsp;</i></span>"),e.put("tbFootSet.tpl.html","<tfoot ng-transclude></tfoot>"),e.put("tbGrid.tpl.html",'<div><div class=tubular-overlay ng-show="$ctrl.showLoading && $ctrl.currentRequest != null"><div><div class="fa fa-refresh fa-2x fa-spin"></div></div></div><ng-transclude></ng-transclude></div>'),e.put("tbGridTable.tpl.html",'<table ng-transclude class="table tubular-grid-table"></table>'),e.put("tbRowSet.tpl.html","<tbody ng-transclude></tbody>"),e.put("tbRowTemplate.tpl.html","<tr ng-transclude></tr>")}])}(angular),function(e){var t=["tubularEditorService","$scope","translateFilter","filterFilter",function(e,t,n,r){var o=this;o.validate=function(){if(o.regex&&o.value&&!1===new RegExp(o.regex).test(o.value))return o.$valid=!1,void(o.state.$errors=[o.regexErrorMessage||n("EDITOR_REGEX_DOESNT_MATCH")]);if(o.match&&o.value!==o.$component.model[o.match]){var e=r(o.$component.fields,{name:o.match},!0)[0].label;return o.$valid=!1,void(o.state.$errors=[n("EDITOR_MATCH",e)])}return o.min&&o.value&&o.value.length<parseInt(o.min)?(o.$valid=!1,void(o.state.$errors=[n("EDITOR_MIN_CHARS",o.min)])):o.max&&o.value&&o.value.length>parseInt(o.max)?(o.$valid=!1,void(o.state.$errors=[n("EDITOR_MAX_CHARS",o.max)])):void 0},o.$onInit=function(){return e.setupScope(t,null,o,!1)}}];e.module("tubular.directives").component("tbSimpleEditor",{templateUrl:"tbSimpleEditor.tpl.html",bindings:{regex:"@?",regexErrorMessage:"@?",value:"=?",isEditing:"=?",editorType:"@",showLabel:"=?",label:"@?",required:"=?",min:"=?",max:"=?",name:"@",placeholder:"@?",readOnly:"=?",help:"@?",defaultValue:"@?",match:"@?"},controller:t})}(angular),function(e){e.module("tubular.directives").directive("tbForm",[function(){return{templateUrl:"tbForm.tpl.html",restrict:"E",replace:!0,transclude:!0,scope:{model:"=?",serverUrl:"@",serverSaveUrl:"@",serverSaveMethod:"@",modelKey:"@?",requireAuthentication:"=?",name:"@?formName"},controller:"tbFormController",compile:function(){return{post:function(e){return e.finishDefinition()}}}}}])}(angular),function(e){var t=0;e.module("tubular.directives").controller("tbFormController",["$scope","$timeout","$element","tubularModel","$http",function(n,r,o,a,l){function i(){var e=n.serverUrl.split("?"),t=e[0]+n.modelKey;return e.length>1&&(t+="?"+e[1]),t}n.tubularDirective="tubular-form",n.hasFieldsDefinitions=!1,n.fields=[];var c=this;c.serverSaveMethod=n.serverSaveMethod||"POST",c.name=n.name||"tbForm"+t++,n.getFormScope=function(){return n[o.attr("name")]},c.requireAuthentication=!!e.isUndefined(n.requireAuthentication)||n.requireAuthentication,n.$watch("hasFieldsDefinitions",function(e){e&&c.retrieveData()}),n.cloneModel=function(t){var r={};e.forEach(t,function(e,t){"$"!==t[0]&&(r[t]=e)}),n.model=new a(n,r),c.bindFields()},c.bindFields=function(){return e.forEach(n.fields,function(e){return e.bindScope()})},c.retrieveData=function(){if(e.isDefined(n.serverUrl))return void l.get(i(),{requireAuthentication:c.requireAuthentication}).then(function(e){n.model=new a(n.model&&n.model.$component||n,e.data),c.bindFields(),n.model.$isNew=!0},function(e){return n.$emit("tbForm_OnConnectionError",e)});e.isUndefined(n.model)&&(n.model=new a(n,{})),c.bindFields()},n.save=function(e,t){if(n.model.$valid()){if(!e&&!n.model.$isNew&&!n.model.$hasChanges())return void n.$emit("tbForm_OnSavingNoChanges",n);n.model.$isLoading=!0,n.currentRequest=l({data:n.model,url:c.serverSaveUrl,method:n.model.$isNew?c.serverSaveMethod||"POST":"PUT",requireAuthentication:c.requireAuthentication}),n.currentRequest.then(function(e){var r=e.data;n.$emit("tbForm_OnSuccessfulSave",r,n),t||n.clear();var o=n.getFormScope();o&&o.$setPristine()},function(e){return n.$emit("tbForm_OnConnectionError",e,n)}).then(function(){n.model.$isLoading=!1,n.currentRequest=null})}},n.update=n.save,n.create=function(){n.model.$isNew=!0,n.save()},n.cancel=function(){n.$emit("tbForm_OnCancel",n.model),n.clear()},n.clear=function(){e.forEach(n.fields,function(e){e.resetEditor?e.resetEditor():(e.value=e.defaultValue,e.dateValue&&(e.dateValue=e.defaultValue))})},n.finishDefinition=function(){var e=r(function(){n.hasFieldsDefinitions=!0,o.find("input").length>0&&o.find("input")[0].focus()},0);n.$emit("tbForm_OnGreetParentController",{controller:c,scope:n}),n.$on("$destroy",function(){return r.cancel(e)})}}])}(angular),function(e){e.module("tubular.directives").component("tbTextSearch",{require:{$component:"^tbGrid"},templateUrl:"tbTextSearch.tpl.html",bindings:{minChars:"@?",placeholder:"@"},controller:"tbTextSearchController"})}(angular),function(e){e.module("tubular.directives").controller("tbTextSearchController",["$scope",function(t){function n(e){r.$component.saveSearch(),r.$component.search.Operator=e,r.$component.retrieveData()}var r=this;r.$onInit=function(){r.minChars=r.minChars||3,r.lastSearch=r.$component.search.Text},t.$watch("$ctrl.$component.search.Text",function(t,o){if(!e.isUndefined(t)&&t!==o){if(r.$component.search.Text=t,r.lastSearch&&""===t)return void n("None");""===t||t.length<r.minChars||t===r.lastSearch||(r.lastSearch=t,n("Auto"))}})}])}(angular),function(e){e.module("tubular.directives").component("tbGrid",{templateUrl:"tbGrid.tpl.html",transclude:!0,bindings:{serverUrl:"@",serverSaveUrl:"@",serverDeleteUrl:"@",serverSaveMethod:"@",pageSize:"=?",requestMethod:"@",requireAuthentication:"@?",name:"@?gridName",editorMode:"@?",showLoading:"=?",autoRefresh:"=?",savePage:"=?",savePageSize:"=?",saveSearchText:"=?"},controller:"tbGridController"})}(angular),function(e){e.module("tubular.directives").controller("tbGridController",["$scope","tubularPopupService","tubularModel","$http","$routeParams","tubularConfig","$window",function(t,n,r,o,a,l,i){function c(e){return e+(-1===e.indexOf("?")?"?":"&")+"timezoneOffset="+(new Date).getTimezoneOffset()}var u=this,s=l.localStorage.prefix(),d=i.localStorage;u.$onInit=function(){u.tubularDirective="tubular-grid",u.name=u.name||"tbgrid",u.columns=[],u.rows=[],u.savePage=!!e.isUndefined(u.savePage)||u.savePage,u.currentPage=u.savePage?parseInt(d.getItem(s+u.name+"_page"))||1:1,u.savePageSize=!!e.isUndefined(u.savePageSize)||u.savePageSize,u.pageSize=u.pageSize||20,u.saveSearchText=!!e.isUndefined(u.saveSearchText)||u.saveSearchText,u.totalPages=0,u.totalRecordCount=0,u.filteredRecordCount=0,u.requestedPage=u.currentPage,u.hasColumnsDefinitions=!1,u.requestCounter=0,u.requestMethod=u.requestMethod||"POST",u.serverSaveMethod=u.serverSaveMethod||"POST",u.currentRequest=null,u.autoSearch=a.param||(u.saveSearchText?d.getItem(s+u.name+"_search")||"":""),u.search={Text:u.autoSearch,Operator:""===u.autoSearch?"None":"Auto"},u.isEmpty=!1,u.tempRow=new r(u,{}),u.requireAuthentication=!u.requireAuthentication||"true"===u.requireAuthentication,u.editorMode=u.editorMode||"none",u.canSaveState=!1,u.showLoading=!!e.isUndefined(u.showLoading)||u.showLoading,u.autoRefresh=!!e.isUndefined(u.autoRefresh)||u.autoRefresh,u.serverDeleteUrl=u.serverDeleteUrl||u.serverSaveUrl,t.$emit("tbGrid_OnGreetParentController",u)},t.columnWatcher=function(){!1!==u.hasColumnsDefinitions&&!1!==u.canSaveState&&d.setItem(s+u.name+"_columns",e.toJson(u.columns))},t.$watch("$ctrl.columns",t.columnWatcher,!0),t.serverUrlWatcher=function(e,t){!1===u.hasColumnsDefinitions||u.currentRequest||e===t||u.retrieveData()},t.$watch("$ctrl.serverUrl",t.serverUrlWatcher),t.hasColumnsDefinitionsWatcher=function(e){!0===e&&u.retrieveData()},t.$watch("$ctrl.hasColumnsDefinitions",t.hasColumnsDefinitionsWatcher),t.pageSizeWatcher=function(){u.hasColumnsDefinitions&&u.requestCounter>0&&(u.savePageSize&&d.setItem(s+u.name+"_pageSize",u.pageSize),u.retrieveData())},t.$watch("$ctrl.pageSize",t.pageSizeWatcher),t.requestedPageWatcher=function(){u.hasColumnsDefinitions&&u.requestCounter>0&&u.retrieveData()},t.$watch("$ctrl.requestedPage",t.requestedPageWatcher),u.saveSearch=function(){u.saveSearchText&&(""===u.search.Text?d.removeItem(s+u.name+"_search"):d.setItem(s+u.name+"_search",u.search.Text))},u.addColumn=function(e){if(null!=e.Name){if(!1!==u.hasColumnsDefinitions)throw"Cannot define more columns. Column definitions have been sealed";u.columns.push(e)}},u.newRow=function(t,o,a,l){u.tempRow=new r(u,l||{}),u.tempRow.$isNew=!0,u.tempRow.$isEditing=!0,u.tempRow.$component=u,e.isDefined(t)&&e.isDefined(o)&&o&&n.openDialog(t,u.tempRow,u,a)},u.deleteRow=function(e){var n=u.serverDeleteUrl.split("?"),r=n[0]+"/"+e.$key;n.length>1&&(r+="?"+n[1]),u.currentRequest=o.delete(r,{requireAuthentication:u.requireAuthentication}).then(function(e){return t.$emit("tbGrid_OnRemove",e.data)},function(e){return t.$emit("tbGrid_OnConnectionError",e)}).then(function(){u.currentRequest=null,u.retrieveData()})},u.saveRow=function(n,r){if(!u.serverSaveUrl)throw"Define a Save URL.";if(!r&&!n.$isNew&&!n.$hasChanges())return n.$isEditing=!1,null;n.$isLoading=!0;var a=n.$component;n.$component=null;var l=e.copy(n);n.$component=a;var i=e.copy(n.$original);return delete l.$isEditing,delete l.$original,delete l.$state,delete l.$valid,delete l.$component,delete l.$isLoading,delete l.$isNew,u.currentRequest=o({url:n.$isNew?c(u.serverSaveUrl):u.serverSaveUrl,method:n.$isNew?u.serverSaveMethod||"POST":"PUT",data:n.$isNew?l:{Old:i,New:l,TimezoneOffset:(new Date).getTimezoneOffset()}}),u.currentRequest.then(function(e){return t.$emit("tbForm_OnSuccessfulSave",e),n.$isLoading=!1,n.$isEditing=!1,u.currentRequest=null,u.retrieveData(),e},function(e){return t.$emit("tbForm_OnConnectionError",e),n.$isLoading=!1,u.currentRequest=null,e}),u.currentRequest},u.verifyColumns=function(){var t=e.fromJson(d.getItem(s+u.name+"_columns"));if(null==t||""===t)return void d.setItem(s+u.name+"_columns",e.toJson(u.columns));e.forEach(t,function(e){var t=u.columns.filter(function(t){return t.Name===e.Name});if(0!==t.length){var n=t[0];n.Visible=e.Visible,u.requestCounter<1&&(n.SortOrder=e.SortOrder,n.SortDirection=e.SortDirection),null!=n.Filter&&null!=n.Filter.Text||null!=e.Filter&&null!=e.Filter.Text&&"None"!==e.Filter.Operator&&(n.Filter=e.Filter)}})},u.getRequestObject=function(e){return-1===e&&(e=(u.requestedPage-1)*u.pageSize)<0&&(e=0),{url:u.serverUrl,method:u.requestMethod||"POST",requireAuthentication:u.requireAuthentication,data:{Count:u.requestCounter,Columns:u.columns,Skip:e,Take:parseInt(u.pageSize),Search:u.search,TimezoneOffset:(new Date).getTimezoneOffset()}}},u.retrieveData=function(){if(u.serverUrl&&null===u.currentRequest){u.canSaveState=!0,u.verifyColumns(),u.savePageSize&&(u.pageSize=parseInt(d.getItem(s+u.name+"_pageSize"))||u.pageSize),u.pageSize=u.pageSize<10?20:u.pageSize;var e=Math.ceil(u.totalRecordCount/u.pageSize);u.requestedPage>e&&(u.requestedPage=e);var n=u.getRequestObject(-1);t.$emit("tbGrid_OnBeforeRequest",n,u),u.currentRequest=o(n),u.currentRequest.then(u.processPayload,function(e){u.requestedPage=u.currentPage,t.$emit("tbGrid_OnConnectionError",e)}).then(function(){return u.currentRequest=null})}},u.processPayload=function(e){if(u.requestCounter+=1,!e||!e.data)return void t.$emit("tbGrid_OnConnectionError",{statusText:"Data is empty",status:0});var o=e.data;if(u.dataSource=o,!o.Payload)return void t.$emit("tbGrid_OnConnectionError","tubularGrid("+u.$id+"): response is invalid.");u.rows=o.Payload.map(function(e){var t=new r(u,e);return t.$component=u,t.editPopup=function(t,o){n.openDialog(t,new r(u,e),u,o)},t}),t.$emit("tbGrid_OnDataLoaded",u),u.aggregationFunctions=o.AggregationPayload,u.currentPage=o.CurrentPage,u.totalPages=o.TotalPages,u.totalRecordCount=o.TotalRecordCount,u.filteredRecordCount=o.FilteredRecordCount,u.isEmpty=0===u.filteredRecordCount,u.savePage&&d.setItem(s+u.name+"_page",u.currentPage)},u.sortColumn=function(n,r){var o=u.columns.filter(function(e){return e.Name===n});if(0!==o.length){var a=o[0];if(!1!==a.Sortable){var l=a.SortDirection,i="None"===l?"Ascending":"Ascending"===l?"Descending":"None";"None"===i?(a.SortOrder=-1,a.SortDirection="None"):(a.SortOrder=Number.MAX_VALUE,a.SortDirection=i),!1===r&&e.forEach(u.columns.filter(function(e){return e.Name!==n}),function(e){e.SortOrder=-1,e.SortDirection="None"});var c=u.columns.filter(function(e){return e.SortOrder>0});c.sort(function(e,t){return e.SortOrder===t.SortOrder?0:e.SortOrder>t.SortOrder}),e.forEach(c,function(e,t){return e.SortOrder=t+1}),t.$broadcast("tbGrid_OnColumnSorted"),u.retrieveData()}}},u.getFullDataSource=function(){var e=u.getRequestObject(0);return e.data.Take=-1,e.data.Search={Text:"",Operator:"None"},o(e).then(function(e){return e.data.Payload},function(e){return t.$emit("tbGrid_OnConnectionError",e)}).then(function(){return u.currentRequest=null})},u.visibleColumns=function(){return u.columns.filter(function(e){return e.Visible}).length}}])}(angular),function(e,t){function n(){var t=e.element('<input type="date" value=":)" />');return"date"===t.attr("type")&&""===t.val()}function r(n){return function(r){if(!e.isUndefined(r)&&(e.isString(r)&&(n.value=""===r||t(r).year()<=1900?"":t(r)),!e.isDefined(n.dateValue)))if(t.isMoment(n.value)){var o=n.value.toObject();n.dateValue=new Date(o.years,o.months,o.date,o.hours,o.minutes,o.seconds)}else n.dateValue=n.value}}function o(t,n,r){if(t.min&&(e.isDate(t.min)||(t.min=new Date(t.min)),t.$valid=t.dateValue>=t.min,!t.$valid))return void(t.state.$errors=[n("EDITOR_MIN_DATE",r(t.min,t.format))]);t.max&&(e.isDate(t.max)||(t.max=new Date(t.max)),t.$valid=t.dateValue<=t.max,t.$valid||(t.state.$errors=[n("EDITOR_MAX_DATE",r(t.max,t.format))]))}t.fn.toJSON=function(){return this.isValid()?this.format():null};var a=["tubularEditorService","$scope","translateFilter",function(t,n,r){var o=this;o.validate=function(){if(e.isDefined(o.min)&&null!=o.min&&e.isDefined(o.value)&&null!=o.value&&(o.$valid=o.value>=o.min,!o.$valid))return void(o.state.$errors=[r("EDITOR_MIN_NUMBER",o.min)]);e.isDefined(o.max)&&null!=o.max&&e.isDefined(o.value)&&null!=o.value&&(o.$valid=o.value<=o.max,o.$valid||(o.state.$errors=[r("EDITOR_MAX_NUMBER",o.max)]))},o.$onInit=function(){o.DataType="numeric",t.setupScope(n,0,o,!1)}}],l=["$scope","$element","tubularEditorService","translateFilter","dateFilter",function(n,a,l,i,c){var u=this;n.$watch(function(){return u.value},r(u)),n.$watch(function(){return u.dateValue},function(n){e.isDefined(n)&&(u.value=""===n?"":t(n))}),u.validate=function(){return o(u,i,c)},u.$onInit=function(){u.DataType="datetime",l.setupScope(n,u.format,u),u.format=u.format||"MMM D, Y"}}],i=["$scope","$element","tubularEditorService","translateFilter","dateFilter",function(n,a,l,i,c){var u=this;n.$watch(function(){return u.value},r(u)),n.$watch(function(){return u.dateValue},function(n){e.isDefined(n)&&(u.value=""===n?"":t(n))}),u.validate=function(){return o(u,i,c)},u.$onInit=function(){u.DataType="date",l.setupScope(n,u.format,u),u.format=u.format||"MMM D, Y"}}],c=["tubularEditorService","$scope","$http",function(t,n,r){var o=this;o.$onInit=function(){t.setupScope(n,null,o),o.dataIsLoaded=!1,o.selectOptions="d for d in $ctrl.options",e.isDefined(o.optionLabel)&&(o.selectOptions="d."+o.optionLabel+" for d in $ctrl.options",e.isDefined(o.optionTrack)?o.selectOptions="d as d."+o.optionLabel+" for d in $ctrl.options track by d."+o.optionTrack:e.isDefined(o.optionKey)&&(o.selectOptions="d."+o.optionKey+" as "+o.selectOptions)),e.isUndefined(o.optionsUrl)||(n.$watch(function(){return o.optionsUrl},function(e,t){e!==t&&(o.dataIsLoaded=!1,o.loadData())}),o.isEditing?o.loadData():n.$watch(function(){return o.isEditing},function(){o.isEditing&&o.loadData()}))},n.updateReadonlyValue=function(){if(o.readOnlyValue=o.value,o.value&&e.isDefined(o.optionLabel)&&o.options)if(e.isDefined(o.optionKey)){var t=o.options.filter(function(e){return e[o.optionKey]===o.value});t.length>0&&(o.readOnlyValue=t[0][o.optionLabel])}else o.readOnlyValue=o.options[o.optionLabel]},n.$watch(function(){return o.value},function(e){n.$emit("tbForm_OnFieldChange",o.$component,o.name,e,o.options),n.updateReadonlyValue()}),o.loadData=function(){if(!o.dataIsLoaded){var t=o.value;o.value="",r({url:o.optionsUrl,method:o.optionsMethod||"GET"}).then(function(n){o.options=n.data,o.dataIsLoaded=!0;var r=o.options&&o.options.length>0?e.isDefined(o.optionKey)?o.options[0][o.optionKey]:o.options[0]:"";o.value=t||o.defaultValue||r;var a=o.getFormField();a&&a.$setDirty()},function(e){return n.$emit("tbGrid_OnConnectionError",e)})}}}];e.module("tubular.directives").component("tbNumericEditor",{templateUrl:"tbNumericEditor.tpl.html",bindings:{value:"=?",isEditing:"=?",showLabel:"=?",label:"@?",required:"=?",format:"@?",min:"=?",max:"=?",name:"@",placeholder:"@?",readOnly:"=?",help:"@?",defaultValue:"@?",step:"=?"},controller:a}).component("tbDateTimeEditor",{template:'<div ng-class="{ \'form-group\' : $ctrl.showLabel && $ctrl.isEditing, \'has-error\' : !$ctrl.$valid && $ctrl.$dirty() }">\n            <span ng-hide="$ctrl.isEditing">{{ $ctrl.value | date: format }}</span>\n            <label ng-show="$ctrl.showLabel" ng-bind="$ctrl.label"></label>'+(n()?'<input type="datetime-local" ng-show="$ctrl.isEditing" ng-model="$ctrl.dateValue" class="form-control" \n                ng-required="$ctrl.required" ng-readonly="$ctrl.readOnly" name="{{$ctrl.name}}"/>':'<div class="input-group" ng-show="$ctrl.isEditing">\n                <input type="text" uib-datepicker-popup="{{$ctrl.format}}" ng-model="$ctrl.dateValue" class="form-control" \n                ng-required="$ctrl.required" ng-readonly="$ctrl.readOnly" name="{{$ctrl.name}}" is-open="$ctrl.open" />\n                <span class="input-group-btn">\n                <button type="button" class="btn btn-default" ng-click="$ctrl.open = !$ctrl.open"><i class="fa fa-calendar"></i></button>\n                </span></div>\n                <div uib-timepicker ng-model="$ctrl.dateValue"  show-seconds="true" show-meridian="false"></div>')+'<span class="help-block error-block" ng-show="$ctrl.isEditing" ng-repeat="error in $ctrl.state.$errors">{{error}}</span>\n            <span class="help-block" ng-show="$ctrl.isEditing && $ctrl.help" ng-bind="$ctrl.help"></span>\n            </div>',bindings:{value:"=?",isEditing:"=?",showLabel:"=?",label:"@?",required:"=?",format:"@?",min:"=?",max:"=?",name:"@",readOnly:"=?",defaultValue:"@?",help:"@?"},controller:l}).component("tbDateEditor",{template:'<div ng-class="{ \'form-group\' : $ctrl.showLabel && $ctrl.isEditing, \'has-error\' : !$ctrl.$valid && $ctrl.$dirty() }">\n            <span ng-hide="$ctrl.isEditing">{{ $ctrl.value | moment: $ctrl.format }}</span>\n            <label ng-show="$ctrl.showLabel" ng-bind="$ctrl.label"></label>'+(n()?'<input type="date" ng-show="$ctrl.isEditing" ng-model="$ctrl.dateValue" class="form-control" ng-required="$ctrl.required" ng-readonly="$ctrl.readOnly" name="{{$ctrl.name}}"/>':'<div class="input-group" ng-show="$ctrl.isEditing"><input type="text" uib-datepicker-popup="{{$ctrl.format}}" ng-model="$ctrl.dateValue" class="form-control" ng-required="$ctrl.required" ng-readonly="$ctrl.readOnly" name="{{$ctrl.name}}" is-open="$ctrl.open" /><span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="$ctrl.open = !$ctrl.open"><i class="fa fa-calendar"></i></button></span></div>')+'<span class="help-block error-block" ng-show="$ctrl.isEditing" ng-repeat="error in $ctrl.state.$errors">{{error}}</span>\n            <span class="help-block" ng-show="$ctrl.isEditing && $ctrl.help" ng-bind="$ctrl.help"></span>\n            </div>',bindings:{value:"=?",isEditing:"=?",showLabel:"=?",label:"@?",required:"=?",format:"@?",min:"=?",max:"=?",name:"@",readOnly:"=?",defaultValue:"@?",help:"@?"},controller:i}).component("tbDropdownEditor",{templateUrl:"tbDropdownEditor.tpl.html",bindings:{value:"=?",isEditing:"=?",showLabel:"=?",label:"@?",required:"=?",name:"@",readOnly:"=?",help:"@?",defaultValue:"@?",options:"=?",optionsUrl:"@",optionsMethod:"@?",optionLabel:"@?",optionKey:"@?",optionTrack:"@?",onChange:"&?"},controller:c}).directive("tbTypeaheadEditor",["$q","$compile",function(t,n){return{restrict:"E",replace:!0,scope:{value:"=?",isEditing:"=?",showLabel:"=?",label:"@?",required:"=?",name:"@",placeholder:"@?",readOnly:"=?",help:"@?",options:"=?",optionsUrl:"@",optionsMethod:"@?",optionLabel:"@?",css:"@?"},link:function(e,t){var r='<div ng-class="{ \'form-group\' : showLabel && isEditing, \'has-error\' : !$valid && $dirty() }">\n                            <span ng-hide="isEditing" ng-bind="value"></span>\n                            <label ng-show="showLabel" ng-bind="label"></label>\n                            <div class="input-group" ng-show="isEditing">\n                            <input ng-model="value" placeholder="{{placeholder}}" title="{{tooltip}}" autocomplete="off" \n                            class="form-control {{css}}" ng-readonly="readOnly || lastSet.indexOf(value) !== -1" uib-typeahead="'+e.selectOptions+'" \n                            ng-required="required" name="{{name}}" /> \n                            <div class="input-group-addon" ng-hide="lastSet.indexOf(value) !== -1"><i class="fa fa-pencil"></i></div>\n                            <span class="input-group-btn" ng-show="lastSet.indexOf(value) !== -1" tabindex="-1">\n                            <button class="btn btn-default" type="button" ng-click="value = null"><i class="fa fa-times"></i>\n                            </span></div>\n                            <span class="help-block error-block" ng-show="isEditing" ng-repeat="error in state.$errors">{{error}}</span>\n                            <span class="help-block" ng-show="isEditing && help" ng-bind="help"></span>\n                            </div>',o=n(r)(e);t.append(o)},controller:["$scope","tubularEditorService","$http",function(n,r,o){r.setupScope(n),n.selectOptions="d for d in getValues($viewValue)",n.lastSet=[],n.optionLabe&&(n.selectOptions="d as d."+n.optionLabel+" for d in getValues($viewValue)"),n.$watch("value",function(e){n.$emit("tbForm_OnFieldChange",n.$component,n.name,e,n.options),n.tooltip=e,e&&n.optionLabel&&(n.tooltip=e[n.optionLabel])}),n.getValues=function(r){return e.isUndefined(n.optionsUrl)?t(function(e){n.lastSet=n.options,e(n.options)}):o({url:n.optionsUrl+"?search="+r,method:n.optionsMethod||"GET"}).then(function(e){return n.lastSet=e.data,n.lastSet})}}]}}]).component("tbCheckboxField",{templateUrl:"tbCheckboxField.tpl.html",bindings:{value:"=?",isEditing:"=?",editorType:"@",showLabel:"=?",label:"@?",required:"=?",name:"@",readOnly:"=?",help:"@?",checkedValue:"=?",uncheckedValue:"=?"},controller:["tubularEditorService","$scope",function(t,n){var r=this;r.$onInit=function(){r.required=!1,r.checkedValue=!e.isDefined(r.checkedValue)||r.checkedValue,r.uncheckedValue=!!e.isDefined(r.uncheckedValue)&&r.uncheckedValue,t.setupScope(n,null,r,!0)}}]}).component("tbTextArea",{templateUrl:"tbTextArea.tpl.html",bindings:{value:"=?",isEditing:"=?",showLabel:"=?",label:"@?",placeholder:"@?",required:"=?",min:"=?",max:"=?",name:"@",readOnly:"=?",help:"@?"},controller:["tubularEditorService","$scope","translateFilter",function(e,t,n){var r=this;r.validate=function(){return r.min&&r.value&&r.value.length<parseInt(r.min)?(r.$valid=!1,void(r.state.$errors=[n("EDITOR_MIN_CHARS",+r.min)])):r.max&&r.value&&r.value.length>parseInt(r.max)?(r.$valid=!1,void(r.state.$errors=[n("EDITOR_MAX_CHARS",+r.max)])):void 0},r.$onInit=function(){return e.setupScope(t,null,r,!1)}}]})}(angular,moment),function(e){e.module("tubular.directives").component("tbColumnFilterButtons",{require:{$columnFilter:"^?tbColumnFilter",$columnDateTimeFilter:"^?tbColumnDateTimeFilter",$columnOptionsFilter:"^?tbColumnOptionsFilter"},templateUrl:"tbColumnFilterButtons.tpl.html",controller:["$scope",function(e){var t=this;t.$onInit=function(){return t.currentFilter=t.$columnFilter||t.$columnDateTimeFilter||t.$columnOptionsFilter||e.$parent.$ctrl}}]}).component("tbColumnSelector",{require:{$component:"^tbGrid"},templateUrl:"tbColumnSelector.tpl.html",controller:["$uibModal",function(e){var t=this;t.openColumnsSelector=function(){var n=t.$component.columns,r=e.open({templateUrl:"tbColumnSelectorDialog.tpl.html",backdropClass:"fullHeight",animation:!1,controller:["$scope",function(e){e.Model=n,e.isInvalid=function(){return 1===e.Model.filter(function(e){return e.Visible}).length},e.closePopup=r.close}]})}}]}).component("tbColumnFilter",{require:{$component:"^tbGrid"},templateUrl:"tbColumnFilter.tpl.html",bindings:{text:"@",argument:"@",operator:"@",title:"@",onlyContains:"=?"},controller:["$scope","tubularTemplateService",function(t,n){var r=this;r.$onInit=function(){r.onlyContains=!e.isUndefined(r.onlyContains)&&r.onlyContains,r.templateName="tbColumnFilterPopover.tpl.html",n.setupFilter(t,r)}}]}).component("tbColumnDateTimeFilter",{require:{$component:"^tbGrid"},templateUrl:"tbColumnDateTimeFilter.tpl.html",bindings:{text:"@",argument:"@",operator:"@",title:"@"},controller:["$scope","tubularTemplateService",function(e,t){var n=this;n.$onInit=function(){n.templateName=t.tbColumnDateTimeFilterPopoverTemplateName,t.setupFilter(e,n)}}]}).component("tbColumnOptionsFilter",{require:{$component:"^tbGrid"},templateUrl:"tbColumnFilter.tpl.html",bindings:{argument:"@",operator:"@",optionsUrl:"@",title:"@"},controller:["$scope","tubularTemplateService","$http",function(e,t,n){var r=this;r.getOptionsFromUrl=function(){if(r.dataIsLoaded)return void e.$apply();n.get(r.filter.OptionsUrl).then(function(e){r.optionsItems=e.data,r.dataIsLoaded=!0},function(t){return e.$emit("tbGrid_OnConnectionError",t)})},r.$onInit=function(){r.dataIsLoaded=!1,r.templateName="tbColumnOptionsFilter.tpl.html",t.setupFilter(e,r),r.getOptionsFromUrl(),r.filter.Operator="Multiple"}}]})}(angular),function(e){e.module("tubular.directives").component("tbRemoveButton",{require:{$component:"^tbGrid"},templateUrl:"tbRemoveButton.tpl.html",bindings:{model:"=",caption:"@",cancelCaption:"@",legend:"@",icon:"@"},controller:function(){var t=this;t.delete=function(){return t.$component.deleteRow(t.model)},t.$onInit=function(){t.showIcon=e.isDefined(t.icon),t.showCaption=!(t.showIcon&&e.isUndefined(t.caption)),t.templateName="tbRemoveButtonPopover.tpl.html"}}}).directive("tbSaveButton",[function(){return{require:"^tbGrid",templateUrl:"tbSaveButton.tpl.html",restrict:"E",replace:!0,scope:{model:"=",isNew:"=?",saveCaption:"@",saveCss:"@",cancelCaption:"@",cancelCss:"@"},controller:["$scope",function(e){e.$component=e.$parent.$parent.$component,e.isNew=e.isNew||!1,e.save=function(){if(e.model.$valid())return e.model.$isNew=e.isNew,e.$component.saveRow(e.model)},e.cancel=function(){return e.model.revertChanges()}}]}}]).component("tbEditButton",{require:{$component:"^tbGrid"},templateUrl:"tbEditButton.tpl.html",bindings:{model:"=",caption:"@"},controller:function(){var e=this;e.edit=function(){"popup"===e.$component.editorMode?e.model.editPopup():e.model.$isEditing=!0}}}).component("tbPageSizeSelector",{require:{$component:"^tbGrid"},templateUrl:"tbPageSizeSelector.tpl.html",bindings:{caption:"@",css:"@",selectorCss:"@",options:"=?"},controller:["$scope",function(t){return t.options=e.isDefined(t.$ctrl.options)?t.$ctrl.options:[10,20,50,100]}]}).component("tbExportButton",{require:{$component:"^tbGrid"},templateUrl:"tbExportButton.tpl.html",bindings:{filename:"@",css:"@",caption:"@",captionMenuCurrent:"@",captionMenuAll:"@"},controller:["tubularGridExportService",function(e){var t=this;t.downloadCsv=function(){return e.exportGridToCsv(t.filename,t.$component)},t.downloadAllCsv=function(){return e.exportAllGridToCsv(t.filename,t.$component)}}]}).component("tbPrintButton",{require:{$component:"^tbGrid"},templateUrl:"tbPrintButton.tpl.html",bindings:{title:"@",printCss:"@",caption:"@"},controller:["tubularGridExportService",function(e){var t=this;t.printGrid=function(){return e.printGrid(t.$component,t.printCss,t.title)}}]})}(angular),function(e){e.module("tubular.directives").component("tbGridPager",{require:{$component:"^tbGrid"},templateUrl:"tbGridPager.tpl.html",controller:["$scope",function(e){var t=this;e.$watch("$ctrl.$component.currentPage",function(){t.$component.currentPage!==t.$component.requestedPage&&(t.$component.requestedPage=t.$component.currentPage)}),t.pagerPageChanged=function(){return t.$component.requestedPage=t.$component.currentPage}}]}).component("tbGridPagerInfo",{require:{$component:"^tbGrid"},templateUrl:"tbGridPagerInfo.tpl.html",bindings:{cssClass:"@?"},controller:["$scope",function(e){var t=this;t.fixCurrentTop=function(){t.currentTop=t.$component.pageSize*t.$component.currentPage,t.currentInitial=(t.$component.currentPage-1)*t.$component.pageSize+1,t.currentTop>t.$component.filteredRecordCount&&(t.currentTop=t.$component.filteredRecordCount),t.currentTop<0&&(t.currentTop=0),(t.currentInitial<0||0===t.$component.totalRecordCount)&&(t.currentInitial=0),t.$component.pageSize>t.$component.filteredRecordCount&&(t.currentInitial=1,t.currentTop=t.$component.filteredRecordCount)},e.$watch("$ctrl.$component.filteredRecordCount",function(){t.filtered=t.$component.totalRecordCount!==t.$component.filteredRecordCount,t.fixCurrentTop()}),e.$watch("$ctrl.$component.currentPage",t.fixCurrentTop),e.$watch("$ctrl.$component.pageSize",t.fixCurrentTop),t.$onInit=t.fixCurrentTop}]})}(angular),function(e,t){e.module("tubular.models",[]).factory("tubularModel",[function(){return function(n,r){var o={$hasChanges:function(){return o.$fields.some(function(t){return e.isDefined(o.$original[t])&&o[t]!==o.$original[t]})},$isEditing:!1,$isNew:!1,$key:"",$fields:[],$state:{},$original:{},$valid:function(){return 0==Object.keys(o.$state).filter(function(t){return e.isDefined(o.$state[t])&&!o.$state[t].$valid()}).length},$addField:function(e,t,n){o.$fields.indexOf(e)>=0||(o[e]=t,o.$fields.push(e),o.$original[e]=n?void 0:t)},resetOriginal:function(){return e.forEach(o.$original,function(e,t){return o.$original[t]=o[t]})},revertChanges:function(){e.forEach(o,function(t,n){e.isDefined(o.$original[n])&&(o[n]=o.$original[n])}),o.$isEditing=!1}};return e.isArray(r)||e.forEach(r,function(e,t){return o.$addField(t,e)}),e.isDefined(n.columns)&&e.forEach(n.columns,function(n,a){var l=e.isDefined(r[a])?r[a]:r[n.Name];"date"!==n.DataType&&"datetime"!==n.DataType&&"datetimeutc"!==n.DataType||(l=null===l||""===l||t(l).year()<=1900?"":"datetimeutc"===n.DataType?t.utc(l):t(l)),o.$addField(n.Name,l),n.IsKey&&(o.$key+=l+",")}),o.$key.length>1&&(o.$key=o.$key.substring(0,o.$key.length-1)),o}}])}(angular,moment),function(e){e.module("tubular.services",["ui.bootstrap"]).config(["$httpProvider",function(e){e.interceptors.push("tubularAuthInterceptor"),e.interceptors.push("tubularNoCacheInterceptor")}])}(angular),function(e){e.module("tubular").filter("errormessage",function(){return function(e){return e&&e.data&&e.data.ExceptionMessage?e.data.ExceptionMessage:e.statusText||"Connection Error"}})}(angular),function(e,t){e.module("tubular").filter("moment",["dateFilter",function(e){return function(n,r){return t.isMoment(n)?n.format(r||"M/DD/YYYY"):e(n)}}])}(angular,moment),function(e){e.module("tubular").filter("numberorcurrency",["numberFilter","currencyFilter",function(e,t){return function(n,r,o,a){return a=a||2,"C"===r?t(n,o||"$",a):"I"===r?parseInt(n):e(n,a)}}])}(angular),function(e){e.module("tubular.services").filter("translate",["tubularTranslate",function(t){return function(n,r,o,a,l){return e.isUndefined(n)?n:t.translate(n).replace("{0}",r||"").replace("{1}",o||"").replace("{2}",a||"").replace("{3}",l||"")}}])}(angular),function(e){e.module("tubular.services").factory("tubularAuthInterceptor",["$q","$injector","tubularConfig",function(e,t,n){function r(r){if(!1===r.requireAuthentication)return r;var a=t.get(u),l=n.webApi;if(r.headers=r.headers||{},!o(r.url)&&l.tokenUrl()!==r.url&&l.refreshTokenUrl()!==r.url&&l.requireAuthentication()){if(!a.isAuthenticated())return e.reject({error:"User not authenticated, new login required.",status:401,config:r});if(l.enableRefreshTokens()&&a.userData.refreshToken&&a.isBearerTokenExpired())return e.reject({error:"expired token",status:401,config:r});r.headers.Authorization="Bearer "+a.userData.bearerToken}return r}function o(e){return/\.(htm|html|css|js|jsx)/.test(e)}function a(t){return e.reject(t)}function l(e){return e}function i(r){var o=e.defer();if(401===r.status){var a=t.get(u),l=n.webApi;l.tokenUrl()!==r.config.url&&l.refreshTokenUrl()!==r.config.url&&l.enableRefreshTokens()&&l.requireAuthentication()&&a.isBearerTokenExpired()&&a.userData.refreshToken?(r.triedRefreshTokens=!0,c||(c=t.get("$http")({method:"POST",url:l.refreshTokenUrl(),headers:{"Content-Type":"application/x-www-form-urlencoded"},data:"grant_type=refresh_token&refresh_token="+a.userData.refreshToken})),c.then(function(e){c=null,a.initAuth(e.data),l.requireAuthentication()&&a.isAuthenticated()?(r.config.headers.Authorization="Bearer "+a.userData.bearerToken,t.get("$http")(r.config).then(function(e){return o.resolve(e)},function(){return o.reject(e)})):o.reject(r)},function(e){c=null,a.removeAuthentication(),o.reject(e),t.get("$location").path("/Login")})):o.reject(r)}else o.reject(r);return o.promise}var c=null,u="tubularHttp";return{request:r,requestError:a,response:l,responseError:i}}])}(angular),function(e){e.module("tubular.services").factory("tubularNoCacheInterceptor",[function(){return{request:function(e){if("GET"!==e.method)return e;if(!/\.htm|blob:|noCache\=/.test(e.url)){var t=-1===e.url.indexOf("?")?"?":"&";e.url=e.url+t+"noCache="+(new Date).getTime()}return e}}}])}(angular),function(e){function t(t){function n(n,r,o,a){(o=o||n).isEditing=!!e.isUndefined(o.isEditing)||o.isEditing,o.showLabel=o.showLabel||!1,o.label=o.label||(o.name||"").replace(/([a-z])([A-Z])/g,"$1 $2"),o.required=o.required||!1,o.readOnly=o.readOnly||!1,o.format=o.format||r,o.$valid=!0,o.state={$valid:function(){return o.checkValid(),0===o.state.$errors.length},$dirty:o.$dirty,$errors:[]},o.getFormField=function(){for(var e=n.$parent;null!=e;){if("tubular-form"===e.tubularDirective){var t=e.getFormScope();return null==t?null:t[n.Name]}e=e.$parent}return null},o.$dirty=function(){var e=o.getFormField();return null==e||e.$dirty},o.checkValid=function(){if(o.$valid=!0,o.state.$errors=[],e.isUndefined(o.value)&&o.required||e.isDate(o.value)&&isNaN(o.value.getTime())&&o.required)return o.$valid=!1,o.state.$errors=[t("EDITOR_REQUIRED")],void(e.isDefined(n.$parent.Model)&&(n.$parent.Model.$state[n.Name]=o.state));e.isDefined(o.validate)&&o.validate()},n.$watch(function(){return o.value},function(t,r){e.isUndefined(r)&&e.isUndefined(t)||(o.$valid=!0,e.isDefined(n.$parent.Model)&&(e.isUndefined(n.$parent.Model.$fields)&&(n.$parent.Model.$fields=[]),-1!==n.$parent.Model.$fields.indexOf(o.name)?(n.$parent.Model[o.name]=t,n.$parent.Model.$state=n.$parent.Model.$state||[],n.$parent.Model.$state[n.Name]=o.state):e.isDefined(n.$parent.Model.$addField)&&n.$parent.Model.$addField(o.name,t,!0)),o.checkValid())});for(var l=n.$parent;null!=l;){if("tubular-form"===l.tubularDirective||"tubular-rowset"===l.tubularDirective){if(null===o.name)return;if(!1!==l.hasFieldsDefinitions)throw"Cannot define more fields. Field definitions have been sealed";o.$component="tubular-form"===l.tubularDirective?l:l.$component,n.Name=o.name,o.bindScope=function(){if(n.$parent.Model=l.model,!1===e.equals(o.value,l.model[n.Name])&&(e.isDefined(l.model[n.Name])&&("date"!==o.DataType&&"datetime"!==o.DataType||null==l.model[n.Name]||!e.isString(l.model[n.Name])?o.value=l.model[n.Name]:""===l.model[n.Name]||null===l.model[n.Name]?o.value=l.model[n.Name]:o.value=moment(l.model[n.Name])),l.$watch(function(){return o.value},function(e){e!==l.model[n.Name]&&(l.model[n.Name]=e)})),n.$watch(function(){return l.model[n.Name]},function(e){e!==o.value&&(o.value=e)},!0),null==o.value&&o.defaultValue&&null!=o.defaultValue&&("date"!==o.DataType&&"datetime"!==o.DataType||!e.isString(o.defaultValue)||(o.defaultValue=new Date(o.defaultValue)),"numeric"===o.DataType&&e.isString(o.defaultValue)&&(o.defaultValue=parseFloat(o.defaultValue)),o.value=o.defaultValue),l.model.$state=l.model.$state||{},l.model.$state[n.Name]={$valid:function(){return o.checkValid(),0===o.state.$errors.length},$dirty:o.$dirty,$errors:o.state.$errors},!1===e.equals(o.state,l.model.$state[n.Name])&&(o.state=l.model.$state[n.Name]),a){var t=o.getFormField();t&&t.$setDirty()}},l.fields.push(o);break}l=l.$parent}}return{setupScope:n}}e.module("tubular.services").factory("tubularEditorService",["translateFilter",t])}(angular),function(e){function t(e){return e.columns.map(function(e){return e.Label})}function n(e){return e.columns.map(function(e){return e.Visible})}function r(t,n,r){var o=function(t){e.isObject(t)&&(t=Object.keys(t).map(function(e){return t[e]}));for(var n="",o=0;o<t.length;o++)if(r[o]){var a=null==t[o]?"":t[o].toString();e.isDate(t[o])&&(a=t[o].toLocaleString());var l=a.replace(/"/g,'""');l.search(/("|,|\n)/g)>=0&&(l='"'+l+'"'),o>0&&(n+=","),n+=l}return n+"\n"},a="";return t.length>0&&(a+=o(t)),e.forEach(n,function(e){return a+=o(e)}),new Blob(["\ufeff"+a],{type:"text/csv;charset=utf-8;"})}e.module("tubular.services").factory("tubularGridExportService",["$window",function(o){var a=this;return a.saveFile=function(t,n){var r=o.URL.createObjectURL(n),a=e.element("<a></a>");a.attr("href",r),a.attr("download",t),a.attr("target","_self"),a[0].click(),o.URL.revokeObjectURL(r)},{exportAllGridToCsv:function(e,o){var l=t(o),i=n(o);o.getFullDataSource().then(function(t){return a.saveFile(e,r(l,t,i))})},exportGridToCsv:function(e,o){if(o.dataSource&&o.dataSource.Payload){var l=t(o),i=n(o);o.currentRequest={},a.saveFile(e,r(l,o.dataSource.Payload,i)),o.currentRequest=null}},printGrid:function(t,n,r){t.getFullDataSource().then(function(a){var l='<table class="table table-bordered table-striped"><thead><tr>'+t.columns.filter(function(e){return e.Visible}).reduce(function(e,t){return e+"<th>"+(t.Label||t.Name)+"</th>"},"")+"</tr></thead><tbody>"+a.map(function(n){return e.isObject(n)&&(n=Object.keys(n).map(function(e){return n[e]})),"<tr>"+n.map(function(n,r){return e.isDefined(t.columns[r])&&!t.columns[r].Visible?"":"<td>"+n+"</td>"}).join(" ")+"</tr>"}).join("  ")+"</tbody></table>",i=o.open("about:blank","Print","menubar=0,location=0,height=500,width=800");i.document.write('<link rel="stylesheet" href="//cdn.jsdelivr.net/bootstrap/latest/css/bootstrap.min.css" />'),""!==n&&i.document.write('<link rel="stylesheet" href="'+n+'" />'),i.document.write('<body onload="window.print();">'),i.document.write("<h1>"+r+"</h1>"),i.document.write(l),i.document.write("</body>"),i.document.close()})}}}])}(angular),function(e){e.module("tubular.services").service("tubularHttp",["$http","$q","$document","tubularConfig","$window",function(t,n,r,o,a){function l(e){var t=new Date;return(e=new Date(e))-t<=0}var i="auth_data",c=o.localStorage.prefix(),u=this;u.userData={isAuthenticated:!1,username:"",bearerToken:"",expirationDate:null},u.isBearerTokenExpired=function(){return l(u.userData.expirationDate)},u.isAuthenticated=function(){return u.userData.isAuthenticated&&!l(u.userData.expirationDate)},u.removeAuthentication=function(){a.localStorage.removeItem(c+i),u.userData.isAuthenticated=!1,u.userData.username="",u.userData.bearerToken="",u.userData.expirationDate=null,u.userData.refreshToken=null},u.authenticate=function(e,r){return this.removeAuthentication(),t({method:"POST",url:o.webApi.tokenUrl(),headers:{"Content-Type":"application/x-www-form-urlencoded"},data:"grant_type=password&username="+encodeURIComponent(e)+"&password="+encodeURIComponent(r)}).then(function(t){return u.initAuth(t.data,e),t.data.authenticated=!0,t.data},function(e){return n.reject(e.data)})},u.initAuth=function(t,n){u.userData.isAuthenticated=!0,u.userData.username=t.userName||n||u.userData.username,u.userData.bearerToken=t.access_token,u.userData.expirationDate=new Date,u.userData.expirationDate=new Date(u.userData.expirationDate.getTime()+1e3*t.expires_in),u.userData.role=t.role,u.userData.refreshToken=t.refresh_token,a.localStorage.setItem(c+i,e.toJson(u.userData))},function(){var t=e.fromJson(a.localStorage.getItem(c+i));null!=t&&(u.userData=t)}()}])}(angular),function(e){e.module("tubular.services").factory("tubularPopupService",["$uibModal","$rootScope","tubularTemplateService",function(t,n,r){return{onSuccessForm:function(e){var t=n.$on("tbForm_OnSuccessfulSave",e);n.$on("$destroy",t)},onConnectionError:function(e){var t=n.$on("tbForm_OnConnectionError",e);n.$on("$destroy",t)},openDialog:function(n,o,a,l){return e.isUndefined(n)&&(n=r.generatePopup(o)),t.open({templateUrl:n,backdropClass:"fullHeight",animation:!1,size:l,controller:"GenericPopupController",resolve:{model:function(){return o},gridScope:function(){return a}}})}}}])}(angular),function(e){e.module("tubular.services").controller("GenericPopupController",["$rootScope","$scope","$uibModalInstance","model","gridScope",function(t,n,r,o,a){n.Model=o,n.savePopup=function(e,t){return e=e||n.Model,t||e.$isNew||e.$hasChanges()?a.saveRow(e,t).then(function(){return r.close()}):(n.closePopup(),null)},n.closePopup=function(){e.isDefined(n.Model.revertChanges)&&n.Model.revertChanges(),r.close()}}])}(angular),function(e){e.module("tubular.services").service("tubularTemplateService",["$templateCache","translateFilter",function(t,n){var r=this;if(r.canUseHtml5Date=function(){var t=e.element('<input type="date" value=":)" />');return"date"===t.attr("type")&&""===t.val()},r.enums={dataTypes:["numeric","date","boolean","string"],editorTypes:["tbSimpleEditor","tbNumericEditor","tbDateTimeEditor","tbDateEditor","tbDropdownEditor","tbTypeaheadEditor","tbCheckboxField","tbTextArea"],httpMethods:["POST","PUT","GET","DELETE"],gridModes:["Read-Only","Inline","Popup","Page"],formLayouts:["Simple","Two-columns","Three-columns"],sortDirections:["Ascending","Descending"]},r.defaults={gridOptions:{Pager:!0,FreeTextSearch:!0,PageSizeSelector:!0,PagerInfo:!0,ExportCsv:!0,Mode:"Read-Only",RequireAuthentication:!1,RequestMethod:"GET",GridName:"grid"},formOptions:{CancelButton:!0,SaveUrl:"",SaveMethod:"POST",Layout:"Simple",ModelKey:"",RequireAuthentication:!1,dataUrl:""},fieldsSettings:{tbSimpleEditor:{ShowLabel:!0,Placeholder:!0,Format:!1,Help:!0,Required:!0,ReadOnly:!0,EditorType:!0},tbNumericEditor:{ShowLabel:!0,Placeholder:!0,Format:!0,Help:!0,Required:!0,ReadOnly:!0,EditorType:!1},tbDateTimeEditor:{ShowLabel:!0,Placeholder:!1,Format:!0,Help:!0,Required:!0,ReadOnly:!0,EditorType:!1},tbDateEditor:{ShowLabel:!0,Placeholder:!1,Format:!0,Help:!0,Required:!0,ReadOnly:!0,EditorType:!1},tbDropdownEditor:{ShowLabel:!0,Placeholder:!1,Format:!1,Help:!0,Required:!0,ReadOnly:!0,EditorType:!1},tbTypeaheadEditor:{ShowLabel:!0,Placeholder:!0,Format:!1,Help:!0,Required:!0,ReadOnly:!0,EditorType:!1},tbCheckboxField:{ShowLabel:!1,Placeholder:!1,Format:!1,Help:!0,Required:!1,ReadOnly:!0,EditorType:!1},tbTextArea:{ShowLabel:!0,Placeholder:!0,Help:!0,Required:!0,ReadOnly:!0,EditorType:!1}}},r.tbColumnDateTimeFilterPopoverTemplateName="tbColumnDateTimeFilterPopoverTemplate.html",!t.get(r.tbColumnDateTimeFilterPopoverTemplateName)){r.tbColumnDateTimeFilterPopoverTemplate='<div><form class="tubular-column-filter-form" onsubmit="return false;"><select class="form-control" ng-options="key as value for (key , value) in $ctrl.filterOperators" ng-model="$ctrl.filter.Operator" ng-hide="$ctrl.dataType == \'boolean\'"></select>&nbsp;'+(r.canUseHtml5Date()?'<input class="form-control" type="date" ng-model="$ctrl.filter.Text" autofocus ng-keypress="$ctrl.checkEvent($event)" placeholder="{{\'CAPTION_VALUE\' | translate}}" ng-disabled="$ctrl.filter.Operator == \'None\'" /><input type="date" class="form-control" ng-model="$ctrl.filter.Argument[0]" ng-keypress="$ctrl.checkEvent($event)" ng-show="$ctrl.filter.Operator == \'Between\'" />':'<div class="input-group"><input type="text" class="form-control" uib-datepicker-popup="MM/dd/yyyy" ng-model="$ctrl.filter.Text" autofocus ng-keypress="$ctrl.checkEvent($event)" placeholder="{{\'CAPTION_VALUE\' | translate}}" ng-disabled="$ctrl.filter.Operator == \'None\'" is-open="$ctrl.dateOpen" /><span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="$ctrl.dateOpen = !$ctrl.dateOpen;"><i class="fa fa-calendar"></i></button></span></div>')+"<hr /><tb-column-filter-buttons></tb-column-filter-buttons></form></div>",t.put(r.tbColumnDateTimeFilterPopoverTemplateName,r.tbColumnDateTimeFilterPopoverTemplate)}r.generateCells=function(e,t){return e.reduce(function(e,n){var r=n.EditorType.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()});return e+'\r\n\t\t<tb-cell-template column-name="'+n.Name+'">\r\n\t\t\t'+("Inline"===t?"<"+r+' is-editing="row.$isEditing" value="row.'+n.Name+'"></'+r+">":n.Template)+"\r\n\t\t</tb-cell-template>"},"")},r.generateGrid=function(e,t){var n="",o="";return t.Pager&&(n+='\r\n\t<tb-grid-pager class="col-md-6"></tb-grid-pager>',o+='\r\n\t<tb-grid-pager class="col-md-6"></tb-grid-pager>'),t.ExportCsv&&(n+='\r\n\t<div class="col-md-3">\r\n\t\t<div class="btn-group">\r\n\t\t<tb-print-button title="Tubular"></tb-print-button>\r\n\t\t<tb-export-button filename="tubular.csv" css="btn-sm"></tb-export-button>\r\n\t\t</div>\r\n\t</div>'),t.FreeTextSearch&&(n+='\r\n\t<tb-text-search class="col-md-3" css="input-sm"></tb-text-search>'),t.PageSizeSelector&&(o+='\r\n\t<tb-page-size-selector class="col-md-3" selectorcss="input-sm"></tb-page-size-selector>'),t.PagerInfo&&(o+='\r\n\t<tb-grid-pager-info class="col-md-3"></tb-grid-pager-info>'),'<div class="container">\r\n<tb-grid server-url="'+t.dataUrl+'" request-method="'+t.RequestMethod+'" class="row" page-size="10" require-authentication="'+t.RequireAuthentication+'" '+("Read-Only"!==t.Mode?' editor-mode="'+t.Mode.toLowerCase()+'"':"")+">"+(""===n?"":'\r\n\t<div class="row">'+n+"\r\n\t</div>")+'\r\n\t<div class="row">\r\n\t<div class="col-md-12">\r\n\t<div class="panel panel-default panel-rounded">\r\n\t<tb-grid-table class="table-bordered">\r\n\t<tb-column-definitions>'+("Read-Only"!==t.Mode?'\r\n\t\t<tb-column label="Actions"><tb-column-header>{{label}}</tb-column-header></tb-column>':"")+e.reduce(function(e,t){return e+'\r\n\t\t<tb-column name="'+t.Name+'" label="'+t.Label+'" column-type="'+t.DataType+'" sortable="'+t.Sortable+'" \r\n\t\t\tis-key="'+t.IsKey+'" searchable="'+t.Searchable+'" '+(t.Sortable?'\r\n\t\t\tsort-direction="'+t.SortDirection+'" sort-order="'+t.SortOrder+'" ':" ")+'visible="'+t.Visible+'">'+(t.Filter?"\r\n\t\t\t<tb-column-filter></tb-column-filter>":"")+"\r\n\t\t\t<tb-column-header>{{label}}</tb-column-header>\r\n\t\t</tb-column>"})+'\r\n\t</tb-column-definitions>\r\n\t<tb-row-set>\r\n\t<tb-row-template ng-repeat="row in $component.rows" row-model="row">'+("Read-Only"!==t.Mode?"\r\n\t\t<tb-cell-template>"+("Inline"===t.Mode?'\r\n\t\t\t<tb-save-button model="row"></tb-save-button>':"")+'\r\n\t\t\t<tb-edit-button model="row"></tb-edit-button>\r\n\t\t</tb-cell-template>':"")+r.generateCells(e,t.Mode)+"\r\n\t</tb-row-template>\r\n\t</tb-row-set>\r\n\t</tb-grid-table>\r\n\t</div>\r\n\t</div>\r\n\t</div>"+(""===o?"":'\r\n\t<div class="row">'+o+"\r\n\t</div>")+"\r\n</tb-grid>\r\n</div>"},r.getEditorTypeByDateType=function(e){switch(e){case"date":return"tbDateTimeEditor";case"numeric":return"tbNumericEditor";case"boolean":return"tbCheckboxField";default:return"tbSimpleEditor"}},r.createColumns=function(t){var n=e.isArray(t)&&t.length>0?t[0]:t,o=[];e.forEach(Object.keys(n),function(t){var r=n[t];if("$"!==t[0]&&!e.isFunction(r)&&null!=r)if(e.isNumber(r)||parseFloat(r).toString()===r)o.push({Name:t,DataType:"numeric",Template:"{{row."+t+" | number}}"});else if(e.isDate(r)||!isNaN(new Date(r).getTime()))o.push({Name:t,DataType:"date",Template:"{{row."+t+" | moment }}"});else if("true"===r.toLowerCase()||"false"===r.toLowerCase())o.push({Name:t,DataType:"boolean",Template:"{{row."+t+' ? "TRUE" : "FALSE" }}'});else{var a={Name:t,DataType:"string",Template:"{{row."+t+"}}"};/e(-|)mail/gi.test(a.Name)&&(a.Template='<a href="mailto:'+a.Template+'">'+a.Template+"</a>"),o.push(a)}});var a=!1;return e.forEach(o,function(e){e.Label=e.Name.replace(/([a-z])([A-Z])/g,"$1 $2"),e.EditorType=r.getEditorTypeByDateType(e.DataType),e.Searchable="string"===e.DataType,e.Filter=!0,e.Visible=!0,e.Sortable=!0,e.IsKey=!1,e.SortOrder=0,e.SortDirection="",e.ShowLabel=!0,e.Placeholder="",e.Format="",e.Help="",e.Required=!0,e.ReadOnly=!1,a||(e.IsKey=!0,e.SortOrder=1,e.SortDirection="Ascending",a=!0)}),o},r.generatePopupTemplate=function(e,t){var n=r.createColumns(e);return'<tb-form model="Model"><div class="modal-header"><h3 class="modal-title">'+(t||"Edit Row")+'</h3></div><div class="modal-body">'+r.generateFieldsArray(n).join("")+'</div><div class="modal-footer"><button class="btn btn-primary" ng-click="savePopup()" ng-disabled="!Model.$valid()">Save</button><button class="btn btn-danger" ng-click="closePopup()" formnovalidate>Cancel</button></div></tb-form>'},r.generatePopup=function(e,n){var o="temp"+(new Date).getTime()+".html",a=r.generatePopupTemplate(e,n);return t.put(o,a),o},r.generateForm=function(e,t){var n="Simple"===t.Layout?"":t.Layout.toLowerCase(),o=r.generateFieldsArray(e),a=void 0;return a=""===n?o.join(""):'\r\n\t<div class="row">'+("two-columns"===n?'\r\n\t<div class="col-md-6">'+o.filter(function(e,t){return t%2==0}).join("")+'\r\n\t</div>\r\n\t<div class="col-md-6">'+o.filter(function(e,t){return t%2==1}).join("")+"</div>":'\r\n\t<div class="col-md-4">'+o.filter(function(e,t){return t%3==0}).join("")+'\r\n\t</div>\r\n\t<div class="col-md-4">'+o.filter(function(e,t){return t%3==1}).join("")+'\r\n\t</div>\r\n\t<div class="col-md-4">'+o.filter(function(e,t){return t%3==2}).join("")+"\r\n\t</div>")+"\r\n\t</div>",'<tb-form server-save-method="'+t.SaveMethod+'" \n                                model-key="'+t.ModelKey+'" \n                                require-authentication="'+t.RequireAuthentication+'" \n                                server-url="'+t.dataUrl+'" \n                                server-save-url="'+t.SaveUrl+'">\r\n\t'+a+'\r\n\t<div>\r\n\t\t<button class="btn btn-primary" ng-click="$parent.save()" ng-disabled="!$parent.model.$valid()">Save</button>'+(t.CancelButton?'\r\n\t\t<button class="btn btn-danger" ng-click="$parent.cancel()" formnovalidate>Cancel</button>':"")+"\r\n\t</div>\r\n</tb-form>"},r.generateFieldsArray=function(e){return e.map(function(e){var t=e.EditorType.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()}),n=r.defaults.fieldsSettings[e.EditorType];return"\r\n\t<"+t+' name="'+e.Name+'"'+(n.EditorType?'\r\n\t\teditor-type="'+e.DataType+'" ':"")+(n.ShowLabel?'\r\n\t\tlabel="'+e.Label+'" show-label="'+e.ShowLabel+'"':"")+(n.Placeholder?'\r\n\t\tplaceholder="'+e.Placeholder+'"':"")+(n.Required?'\r\n\t\trequired="'+e.Required+'"':"")+(n.ReadOnly?'\r\n\t\tread-only="'+e.ReadOnly+'"':"")+(n.Format?'\r\n\t\tformat="'+e.Format+'"':"")+(n.Help?'\r\n\t\thelp="'+e.Help+'"':"")+">\r\n\t</"+t+">"})},r.setupFilter=function(t,r){var o={None:n("OP_NONE"),Equals:n("OP_EQUALS"),NotEquals:n("OP_NOTEQUALS"),Between:n("OP_BETWEEN"),Gte:">=",Gt:">",Lte:"<=",Lt:"<"},a={string:{None:n("OP_NONE"),Equals:n("OP_EQUALS"),NotEquals:n("OP_NOTEQUALS"),Contains:n("OP_CONTAINS"),NotContains:n("OP_NOTCONTAINS"),StartsWith:n("OP_STARTSWITH"),NotStartsWith:n("OP_NOTSTARTSWITH"),EndsWith:n("OP_ENDSWITH"),NotEndsWith:n("OP_NOTENDSWITH")},numeric:{None:n("OP_NONE"),Equals:n("OP_EQUALS"),Between:n("OP_BETWEEN"),Gte:">=",Gt:">",Lte:"<=",Lt:"<"},date:o,datetime:o,datetimeutc:o,boolean:{None:n("OP_NONE"),Equals:n("OP_EQUALS"),NotEquals:n("OP_NOTEQUALS")}};r.filter={Text:r.text||null,Argument:r.argument?[r.argument]:null,Operator:r.operator||"Contains",OptionsUrl:r.optionsUrl||null,HasFilter:!(null==r.text||""===r.text||e.isUndefined(r.text)),Name:t.$parent.$parent.column.Name},r.filterTitle=r.title||n("CAPTION_FILTER"),t.$watch(function(){var e=r.$component.columns.filter(function(e){return e.Name===r.filter.Name});return 0!==e.length?e[0]:null},function(e){e&&("date"!==e.DataType&&"datetime"!==e.DataType&&"datetimeutc"!==e.DataType||""===r.filter.Text||null==r.filter.Text||(r.filter.Text=new Date(r.filter.Text)),r.filter.HasFilter!==e.Filter.HasFilter&&(r.filter.HasFilter=e.Filter.HasFilter,r.filter.Text=e.Filter.Text,r.retrieveData()))},!0),r.retrieveData=function(){var e=r.$component.columns.filter(function(e){return e.Name===r.filter.Name});0!==e.length&&(e[0].Filter=r.filter),r.$component.retrieveData(),r.close()},r.clearFilter=function(){"Multiple"!==r.filter.Operator&&(r.filter.Operator="None"),e.isDefined(r.onlyContains)&&r.onlyContains&&(r.filter.Operator="Contains"),r.filter.Text="",r.filter.Argument=[],r.filter.HasFilter=!1,r.retrieveData()},r.applyFilter=function(){r.filter.HasFilter=!0,r.retrieveData()},r.close=function(){return r.isOpen=!1},r.checkEvent=function(e){13===e.which&&(r.applyFilter(),e.preventDefault())};var l=r.$component.columns.filter(function(e){return e.Name===r.filter.Name});t.$watch("$ctrl.filter.Operator",function(e){"None"===e&&(r.filter.Text="")}),0!==l.length&&(t.$watch("$ctrl.filter",function(e){l[0].Filter.Text!==e.Text&&(e.Text=l[0].Filter.Text,l[0].Filter.Operator!==e.Operator&&(e.Operator=l[0].Filter.Operator)),r.filter.HasFilter=l[0].Filter.HasFilter}),l[0].Filter=r.filter,r.dataType=l[0].DataType,r.filterOperators=a[r.dataType],"date"!==r.dataType&&"datetime"!==r.dataType&&"datetimeutc"!==r.dataType||(r.filter.Argument=[new Date],"Contains"===r.filter.Operator&&(r.filter.Operator="Equals")),"numeric"!==r.dataType&&"boolean"!==r.dataType||(r.filter.Argument=[1],"Contains"===r.filter.Operator&&(r.filter.Operator="Equals")))}}])}(angular),function(e){e.module("tubular.services").service("tubularTranslate",[function(){var e=this;e.currentLanguage="en",e.defaultLanguage="en",e.translationTable={en:{EDITOR_REGEX_DOESNT_MATCH:"The field doesn't match the regular expression.",EDITOR_REQUIRED:"The field is required.",EDITOR_MIN_CHARS:"The field needs to be minimum {0} chars.",EDITOR_MAX_CHARS:"The field needs to be maximum {0} chars.",EDITOR_MIN_NUMBER:"The minimum number is {0}.",EDITOR_MAX_NUMBER:"The maximum number is {0}.",EDITOR_MIN_DATE:"The minimum date is {0}.",EDITOR_MAX_DATE:"The maximum date is {0}.",EDITOR_MATCH:"The field needs to match the {0} field.",CAPTION_APPLY:"Apply",CAPTION_CLEAR:"Clear",CAPTION_CLOSE:"Close",CAPTION_SELECTCOLUMNS:"Select Columns",CAPTION_FILTER:"Filter",CAPTION_VALUE:"Value",CAPTION_REMOVE:"Remove",CAPTION_CANCEL:"Cancel",CAPTION_EDIT:"Edit",CAPTION_SAVE:"Save",CAPTION_PRINT:"Print",CAPTION_LOAD:"Load",CAPTION_ADD:"Add",UI_SEARCH:"search . . .",UI_PAGESIZE:"Page size:",UI_EXPORTCSV:"Export CSV",UI_CURRENTROWS:"Current rows",UI_ALLROWS:"All rows",UI_REMOVEROW:"Do you want to delete this row?",UI_SHOWINGRECORDS:"Showing {0} to {1} of {2} records",UI_FILTEREDRECORDS:"(Filtered from {0} total records)",UI_HTTPERROR:"Unable to contact server; please, try again later.",UI_GENERATEREPORT:"Generate Report",UI_TWOCOLS:"Two columns",UI_ONECOL:"One column",UI_MAXIMIZE:"Maximize",UI_RESTORE:"Restore",UI_MOVEUP:"Move Up",UI_MOVEDOWN:"Move Down",UI_MOVELEFT:"Move Left",UI_MOVERIGHT:"Move Right",UI_COLLAPSE:"Collapse",UI_EXPAND:"Expand",OP_NONE:"None",OP_EQUALS:"Equals",OP_NOTEQUALS:"Not Equals",OP_CONTAINS:"Contains",OP_NOTCONTAINS:"Not Contains",OP_STARTSWITH:"Starts With",OP_NOTSTARTSWITH:"Not Starts With",OP_ENDSWITH:"Ends With",OP_NOTENDSWITH:"Not Ends With",OP_BETWEEN:"Between"},es:{EDITOR_REGEX_DOESNT_MATCH:"El campo no es vlido contra la expresin regular.",EDITOR_REQUIRED:"El campo es requerido.",EDITOR_MIN_CHARS:"El campo requiere mnimo {0} caracteres.",EDITOR_MAX_CHARS:"El campo requiere mximo {0} caracteres.",EDITOR_MIN_NUMBER:"El nmero mnimo es {0}.",EDITOR_MAX_NUMBER:"El nmero maximo es {0}.",EDITOR_MIN_DATE:"La fecha mnima es {0}.",EDITOR_MAX_DATE:"La fecha mxima es {0}.",EDITOR_MATCH:"El campo debe de conincidir con el campo {0}.",CAPTION_APPLY:"Aplicar",CAPTION_CLEAR:"Limpiar",CAPTION_CLOSE:"Cerrar",CAPTION_SELECTCOLUMNS:"Seleccionar columnas",CAPTION_FILTER:"Filtro",CAPTION_VALUE:"Valor",CAPTION_REMOVE:"Remover",CAPTION_CANCEL:"Cancelar",CAPTION_EDIT:"Editar",CAPTION_SAVE:"Guardar",CAPTION_PRINT:"Imprimir",CAPTION_LOAD:"Cargar",CAPTION_ADD:"Agregar",UI_SEARCH:"buscar . . .",UI_PAGESIZE:"# Registros:",UI_EXPORTCSV:"Exportar CSV",UI_CURRENTROWS:"Esta pgina",UI_ALLROWS:"Todo",UI_REMOVEROW:"Desea eliminar el registro?",UI_SHOWINGRECORDS:"Mostrando registros {0} al {1} de {2}",UI_FILTEREDRECORDS:"(De un total de {0} registros)",UI_HTTPERROR:"No se logro contactar el servidor, intente ms tarde.",UI_GENERATEREPORT:"Generar Reporte",UI_TWOCOLS:"Dos columnas",UI_ONECOL:"Una columna",UI_MAXIMIZE:"Maximizar",UI_RESTORE:"Restaurar",UI_MOVEUP:"Mover Arriba",UI_MOVEDOWN:"Mover Abajo",UI_MOVELEFT:"Mover Izquierda",UI_MOVERIGHT:"Mover Derecha",UI_COLLAPSE:"Colapsar",UI_EXPAND:"Expandir",OP_NONE:"Ninguno",OP_EQUALS:"Igual",OP_NOTEQUALS:"No Igual",OP_CONTAINS:"Contiene",OP_NOTCONTAINS:"No Contiene",OP_STARTSWITH:"Comienza Con",OP_NOTSTARTSWITH:"No Comienza Con",OP_ENDSWITH:"Termina Con",OP_NOTENDSWITH:"No Termina Con",OP_BETWEEN:"Entre"}},e.setLanguage=function(t){return e.currentLanguage=t},e.addTranslation=function(t,n,r){(e.translationTable[t]||e.translationTable[e.currentLanguage]||e.translationTable[e.defaultLanguage])[n]=r},e.translate=function(t){return(e.translationTable[e.currentLanguage]||e.translationTable[e.defaultLanguage])[t]||t}}])}(angular),function(e){e.module("tubular.services").provider("tubularConfig",function(){function t(e,t){i.platform[e]=t,a.platform[e]={},n(i,i.platform[e]),r(i.platform[e],a.platform[e],"")}function n(t,r){for(var o in t)o!=l&&t.hasOwnProperty(o)&&(e.isObject(t[o])?(e.isUndefined(r[o])&&(r[o]={}),n(t[o],r[o])):e.isUndefined(r[o])&&(r[o]=null))}function r(t,n,a){e.forEach(t,function(c,u){e.isObject(t[u])?(n[u]={},r(t[u],n[u],a+"."+u)):n[u]=function(e){return arguments.length?(t[u]=e,n):t[u]==l?o(i.platform,"default"+a+"."+u):t[u]}})}function o(t,n){n=n.split(".");for(var r=0;r<n.length;r++){if(!t||!e.isDefined(t[n[r]]))return null;t=t[n[r]]}return t}var a=this;a.platform={};var l="platform",i={webApi:{tokenUrl:l,refreshTokenUrl:l,enableRefreshTokens:l,requireAuthentication:l,baseUrl:l},platform:{},localStorage:{prefix:l}};r(i,a,""),t("default",{webApi:{tokenUrl:"/api/token",refreshTokenUrl:"/api/token",enableRefreshTokens:!1,requireAuthentication:!0,baseUrl:"/api"},localStorage:{prefix:"tubular."}}),a.setPlatformConfig=t,a.$get=function(){return a}})}(angular);